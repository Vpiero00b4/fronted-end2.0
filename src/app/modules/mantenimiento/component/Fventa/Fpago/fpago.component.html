<div class="container-fluid py-3">
  <div class="row justify-content-center">
    <div class="col-lg-10">

      <!-- Header de la Pantalla de Pago -->
      <div class="card shadow-sm border-0 rounded-3 mb-3">
        <div class="card-header bg-primary text-white py-2">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0 fw-semibold">
              <i class="fas fa-credit-card me-2"></i>Procesar Pago
            </h5>
            <button type="button" class="btn btn-sm btn-outline-light" (click)="cerrar.emit()">
              <i class="fas fa-times me-1"></i>Cerrar
            </button>
          </div>
        </div>
        <div class="card-body p-2">
          <div class="row g-2 text-center">
            <div class="col-md-3">
              <small class="text-muted">Cliente:</small>
              <div class="fw-semibold">{{ cliente?.nombre }} {{ cliente?.apellidoPaterno }}</div>
            </div>
            <div class="col-md-3">
              <small class="text-muted">Documento:</small>
              <div class="fw-semibold">{{ cliente?.tipoDocumento }} {{ cliente?.numeroDocumento }}</div>
            </div>
            <div class="col-md-3">
              <small class="text-muted">Comprobante:</small>
              <div class="fw-semibold">{{ tipoComprobante }}</div>
            </div>
            <div class="col-md-3">
              <small class="text-muted">Total a Pagar:</small>
              <div class="fw-bold text-success fs-5">S/ {{ totalPagar | number:'1.2-2' }}</div>
            </div>
          </div>
        </div>
      </div>

      <form [formGroup]="pagoForm" class="row g-3">

        <!-- üíµ COLUMNA IZQUIERDA: M√©todo de Pago -->
        <div class="col-md-6">
          <div class="card shadow-sm border-0 rounded-3">
            <div class="card-header bg-success text-white py-2">
              <h6 class="mb-0 fw-semibold">
                <i class="fas fa-wallet me-2"></i>M√©todo de Pago
              </h6>
            </div>
            <div class="card-body p-3">

              <!-- Selector de Tipo de Pago -->
              <div class="mb-3">
                <label class="form-label small fw-semibold">Selecciona el M√©todo</label>
                <div class="btn-group w-100" role="group">
                  <input type="radio" class="btn-check" id="pagoEfectivo" value="Efectivo" formControlName="tipoPago">
                  <label class="btn btn-outline-success" for="pagoEfectivo">
                    <i class="fas fa-money-bill-wave me-1"></i>Efectivo
                  </label>
                  <input type="radio" class="btn-check" id="pagoDigital" value="Digital" formControlName="tipoPago">
                  <label class="btn btn-outline-info" for="pagoDigital">
                    <i class="fas fa-mobile-alt me-1"></i>Digital
                  </label>
                  <input type="radio" class="btn-check" id="pagoMixto" value="Mixto" formControlName="tipoPago">
                  <label class="btn btn-outline-warning" for="pagoMixto">
                    <i class="fas fa-coins me-1"></i>Mixto
                  </label>
                </div>
              </div>

              <!-- Monto en Efectivo -->
              <div class="mb-3">
                <label class="form-label small fw-semibold">
                  <i class="fas fa-money-bill me-1 text-success"></i>Efectivo Recibido
                </label>
                <div class="input-group">
                  <span class="input-group-text">S/</span>
                  <input type="number" class="form-control" formControlName="efectivoRecibido" placeholder="0.00"
                    min="0" step="0.01">
                  <!-- <button type="button" class="btn btn-outline-secondary" (click)="setMontoEfectivoExacto()">
                    <i class="fas fa-hand-holding-usd" title="Monto exacto"></i>
                  </button> -->

                </div>
                <small class="text-muted">
                  <i class="fas fa-info-circle me-1"></i>Ingresa el monto recibido del cliente
                </small>
              </div>

              <!-- Monto Digital -->
              <div class="mb-3">
                <label class="form-label small fw-semibold">
                  <i class="fas fa-mobile-alt me-1 text-info"></i>Pago Digital (Yape/Plin)
                </label>
                <div class="input-group">
                  <span class="input-group-text">S/</span>
                  <input type="number" class="form-control" formControlName="montoDigital" placeholder="0.00" min="0"
                    step="0.01">
                  <!-- <button type="button" class="btn btn-outline-secondary" (click)="setMontoDigitalExacto()">
                    <i class="fas fa-qrcode" title="Monto exacto"></i>
                  </button> -->

                </div>
                <small class="text-muted">
                  <i class="fas fa-info-circle me-1"></i>Confirma el monto recibido por transferencia
                </small>
              </div>

              <!-- Calculadora R√°pida -->
              <div class="border rounded-2 p-2 bg-light">
                <small class="text-muted fw-semibold">Calculadora R√°pida</small>
                <div class="row g-1 mt-1">
                  <div class="col-4">
                    <button type="button" class="btn btn-outline-primary btn-sm w-100"
                      onclick="sumarMonto(10)">+10</button>
                  </div>
                  <div class="col-4">
                    <button type="button" class="btn btn-outline-primary btn-sm w-100"
                      onclick="sumarMonto(20)">+20</button>
                  </div>
                  <div class="col-4">
                    <button type="button" class="btn btn-outline-primary btn-sm w-100"
                      onclick="sumarMonto(50)">+50</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- üìä COLUMNA DERECHA: Resumen y Validaci√≥n -->
        <div class="col-md-6">
          <div class="card shadow-sm border-0 rounded-3">
            <div class="card-header bg-info text-white py-2">
              <h6 class="mb-0 fw-semibold">
                <i class="fas fa-calculator me-2"></i>Resumen de Pago
              </h6>
            </div>
            <div class="card-body p-3">

              <!-- Resumen Financiero -->
              <div class="border rounded-2 p-3 bg-light mb-3">
                <div class="row g-2">
                  <div class="col-6">
                    <div class="d-flex justify-content-between">
                      <span class="small text-muted">Subtotal:</span>
                      <span class="fw-semibold">S/ {{ subtotal | number:'1.2-2' }}</span>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="d-flex justify-content-between">
                      <span class="small text-muted">Descuento:</span>
                      <span class="fw-semibold text-danger">- S/ {{ totalDescuento | number:'1.2-2' }}</span>
                    </div>
                  </div>
                  <div class="col-12">
                    <hr class="my-2">
                    <div class="d-flex justify-content-between">
                      <span class="fw-semibold">Total a Pagar:</span>
                      <span class="fw-bold text-primary fs-5">S/ {{ totalPagar | number:'1.2-2' }}</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Validaci√≥n de Pago -->
              <div class="border rounded-2 p-3 mb-3"
                [ngClass]="{'border-success bg-success bg-opacity-10': vuelto >= 0, 'border-danger bg-danger bg-opacity-10': vuelto < 0}">
                <h6 class="fw-semibold mb-2">
                  <i class="fas fa-check-circle me-1"
                    [ngClass]="{'text-success': vuelto >= 0, 'text-danger': vuelto < 0}"></i>
                  Validaci√≥n de Pago
                </h6>

                <div class="row g-2 small">
                  <div class="col-6">
                    <div class="d-flex justify-content-between">
                      <span class="text-muted">Efectivo:</span>
                      <span class="fw-semibold">S/ {{ pagoForm.get('efectivoRecibido')?.value || 0 | number:'1.2-2'
                        }}</span>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="d-flex justify-content-between">
                      <span class="text-muted">Digital:</span>
                      <span class="fw-semibold">S/ {{ pagoForm.get('montoDigital')?.value || 0 | number:'1.2-2'
                        }}</span>
                    </div>
                  </div>
                  <div class="col-12">
                    <hr class="my-2">
                    <div class="d-flex justify-content-between">
                      <span class="fw-semibold">Total Recibido:</span>
                      <span class="fw-bold">S/ {{ (pagoForm.get('efectivoRecibido')?.value || 0) +
                        (pagoForm.get('montoDigital')?.value || 0) | number:'1.2-2' }}</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Vuelto -->
              <div class="text-center p-3 rounded-2"
                [ngClass]="{'bg-success text-white': vuelto >= 0, 'bg-danger text-white': vuelto < 0}">
                <div class="small">VUELTO</div>
                <div class="fs-3 fw-bold">
                  <i class="fas fa-hand-holding-usd me-2"></i>
                  S/ {{ vuelto | number:'1.2-2' }}
                </div>
                <div class="small" *ngIf="vuelto < 0">
                  <i class="fas fa-exclamation-triangle me-1"></i>
                  Falta: S/ {{ Math.abs(vuelto) | number:'1.2-2' }}
                </div>
                <div class="small" *ngIf="vuelto > 0">
                  <i class="fas fa-check-circle me-1"></i>
                  Entregar al cliente
                </div>
                <div class="small" *ngIf="vuelto === 0">
                  <i class="fas fa-thumbs-up me-1"></i>
                  Pago exacto
                </div>
              </div>

              <!-- Botones de Acci√≥n -->
              <div class="d-flex justify-content-between mt-3">
                <button type="button" class="btn btn-outline-secondary" (click)="cerrar.emit()">
                  <i class="fas fa-times me-1"></i>Cancelar
                </button>
                <button type="button" class="btn btn-success" [disabled]="!ventaValida()" (click)="onConfirmarPago()">
                  <i class="fas fa-check me-1"></i>Confirmar y Registrar
                  <span class="ms-1 badge bg-light text-dark">S/ {{ totalPagar | number:'1.2-2' }}</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  // Funci√≥n para agregar montos r√°pidos
  function sumarMonto(valor) {
    const efectivoInput = document.querySelector('input[formControlName="efectivoRecibido"]');
    if (efectivoInput) {
      const valorActual = parseFloat(efectivoInput.value) || 0;
      efectivoInput.value = (valorActual + valor).toFixed(2);
      efectivoInput.dispatchEvent(new Event('input'));
    }
  }
</script>